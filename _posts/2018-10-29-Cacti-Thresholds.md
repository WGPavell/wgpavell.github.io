---
layout: post
title: Тревожный кактус
---

*Вероятно, я ждал, что один из первых постов будет посвящен какому-нибудь фреймворку, но что-то пошло не так.*

![Cacti](/images/cacti.png)

Недавно мне была поставлена задача изучить систему мониторинга сетевых устройств Cacti. Довольно мерзкая вещь, если учесть времена, откуда у неё ноги растут. Старый интерфейс, код на соплях и многое другое заставили меня поломать мозг в попытках понять как работает эта, на первый взгляд из палеозойской эры, система. Помню, как еще недавно бился головой об клаву в попытках решить проблему с построением графиков. Если коротко, то все графики хранятся в отдельных файлах, а для их изменения системе не хватало прав. Аналогично и с логами, они тупо не писались (хотя еще на этапе установки система смогла сделать первые записи). Это довольно странно, учитывая, что по идее кактус должен разворачиваться на машине автоматом (включая и все необходимые права на файлы и директории, которые изначально мне тоже пришлось редактировать). Но все же, эту проблему я оставил позади (если в этом и заключалась вообще проблема, ибо система странная и не всегда заводится с первого раза).

В будущем еще предстоит придумать способ занести в систему порядка ~1000 устройств и под каждое из них создавать график на каждый интерфейс, а также выносить их на отдельное древо. Вроде как проблему с автоматическим созданием графиков и занесением устройства на дерево я решил, для этого в Cacti 1+ версии используется встроенный плагин автоматизации. Найти его можно в меню консоли категории __Automation__. Автоматизировать в системе можно практически все, начиная от банального размещения на древе, заканчивая сканированием подсетей и добавлением устройств. Для этого там задаются специальные шаблоны и это чем-то напоминает ветвление. По умолчанию все это добро по какой-то причине выключено (учитывая, что есть некоторые уже готовые шаблоны) и нужно все ручками подрубать.

![Шаблон устройства](/images/cacti_thresholds/1.png)
![Шаблон графиков](/images/cacti_thresholds/2.png)

Как видно по скриншотам, шаблоны очень примитивные и охватывают практически каждое устройство. В данном случае на графики наносятся физические интерфейсы в состоянии Up устройств, которым прописан какой-либо *hostname*.


